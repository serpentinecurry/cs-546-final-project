<a href="/professor/course/{{course._id}}" class="btn btn-secondary mb-3">Back to Course</a>

<h1>Lecture {{lecture.lectureTitle}} for course {{course.courseName}} </h1>
<h2>Attendance Sheet</h2>

<form method="POST" action="/professor/course/{{course._id}}/lecture/{{lecture._id}}/attendance"
      class="attendance-form">
    {{#each students}}
        <div class="student">
            <p>{{this.firstName}} {{this.lastName}}</p>
            <select name="attendanceData[{{this._id}}]">
                <option value="" disabled {{#unless this.attendanceStatus}}selected{{/unless}}>Select Attendance
                </option>
                <option value="present" {{#if (eq this.attendanceStatus "present")}}selected{{/if}}>Present</option>
                <option value="absent" {{#if (eq this.attendanceStatus "absent")}}selected{{/if}}>Absent</option>
                <option value="excused" {{#if (eq this.attendanceStatus "excused")}}selected{{/if}}>Excused</option>
            </select>
        </div>
    {{/each}}
    <button type="submit">Submit Attendance</button>
</form>

<div class="lecture-details mb-4">
    <h2>Lecture Details</h2>
    <p><strong>Title:</strong> {{lecture.lectureTitle}}</p>
    <p><strong>Date:</strong> {{lecture.lectureDate}}</p>
    <p><strong>Lecture Time:</strong> {{lectureStartTime}} - {{lectureEndTime}} </p>
    <p><strong>Description:</strong> {{lecture.description}}</p>
    <p><strong>Materials:</strong> <a href="{{lecture.materialsLink}}">{{lecture.materialsLink}}</a></p>
    <p><strong>Average Rating:</strong> {{averageRating}} / 5</p>

    <a href="/professor/course/{{course._id}}/lecture/{{lecture._id}}/edit" class="btn btn-warning">
        <i class="bi bi-pencil-square me-1"></i> Edit Lecture
    </a>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    
    const form = document.querySelector('.attendance-form');
    if (!form) return;
    
    
    form.addEventListener('submit', function(event) {
      
      const studentDivs = document.querySelectorAll('.student');
      const unselectedStudents = [];
      
      
      studentDivs.forEach(div => {
        const studentName = div.querySelector('p').textContent.trim();
        const select = div.querySelector('select');
        
        
        if (!select.value) {
          unselectedStudents.push(studentName);
          div.classList.add('bg-danger', 'text-white', 'p-2', 'mb-2'); 
        } else {
          div.classList.remove('bg-danger', 'text-white', 'p-2', 'mb-2');
        }
      });
      
      
      if (unselectedStudents.length > 0) {
        event.preventDefault();
        alert('Not all attendance data filled: ' + unselectedStudents.join(', '));
        return false;
      }
    });
  });
</script>